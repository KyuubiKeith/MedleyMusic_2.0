/*--- define vars ---*/
var $menu,
	$page,
	$htmlbody,
	$closeMenu,
	$scrollDown,
	$openModal,
	$closeModal,
	$modal,
	$categoryNavItem,
	$openFaq,
	$openDay,
	wScroll,
	height,
	width,
	checkoutOffset,
	pageClickTrigger = 0,
	forDropdownOption,
	activeInput,
	activeOption,
	audio,
	ps,
	lessons,
	parties,
	veroCafe,
    video,
    homeHeaderHeight;

(function(){
	/*--- init vars ---*/
	$menu = $('[data-menu]');
	$page = $('[data-page]');
	$htmlbody = $('html, body');
	$closeMenu = $('[data-close-menu]');
	$scrollDown = $('[data-scroll-down]');
	$openModal = $('[data-open-modal]');
	$closeModal = $('[data-close-modal]');
	$modal = $('[data-modal]');
	$categoryNavItem = $('[data-category-nav-item]');
	$openFaq = $('[data-open-faq]');
	$openDay = $('[data-day]');
	height = $(window).height();
	width = $(window).width();

	if($('[data-slider]').length){
		initSlider();
	}

	if($('#map').length){
		callMap();
	}

	wScroll = $(window).scrollTop();
    
    if(wScroll > 0){
        $('.header').addClass('header--sticky');
    }

    if($('.section--header').length){
		homeHeaderHeight = $('.section--header').height();
        if(wScroll > homeHeaderHeight){
            if($('.video-sound').hasClass('video-sound--active')){
                audio.volume = 0;
                $('.video-sound').toggleClass('video-sound--active');
            }
        }
	}

	if($('.letters--h').length && $('.parties__row').length){
        paralaxLetterHSlow();
	}
	else if($('.letters--h').length){
        paralaxLetterH();
	}

	if($('.letters--a').length && $('.parties__row').length){
        paralaxLetterASlow();
	}
	else if($('.letters--a').length){
		paralaxLetterA();
	}

    if($('.letters--r').length && $('.parties__row').length){
        paralaxLetterRSlow();
    }
	else if($('.letters--r').length){
		paralaxLetterR();
	}

    if($('.letters--l').length && $('.parties__row').length){
        paralaxLetterLSlow();
    }
	else if($('.letters--l').length){
		paralaxLetterL();
	}

    if($('.letters--e').length && $('.parties__row').length){
        paralaxLetterESlow();
    }
	else if($('.letters--e').length){
		paralaxLetterE();
	}

    if($('.letters--m').length && $('.parties__row').length){
        paralaxLetterMSlow();
    }
	else if($('.letters--m').length){
		paralaxLetterM();
	}

	if($('.highlights__row--first').length){
		if(wScroll > $('.highlights__row--first').offset().top - height / 1.5){
			$('.highlights__row--first > .person-block--highlights').each(function(i){
				setTimeout(function(){
					$('.highlights__row--first > .person-block--highlights').eq(i).addClass('person-block--show');
				}, i * 200);
			});
		}
	}

	if($('.highlights__row--second').length){
		if(wScroll > $('.highlights__row--second').offset().top - height / 1.5){
			$('.highlights__row--second > .person-block--highlights').each(function(i){
				setTimeout(function(){
					$('.highlights__row--second > .person-block--highlights').eq(i).addClass('person-block--show');
				}, i * 200);
			});
		}
	}

	if($('.about__img-cover--1').length){
		if(wScroll > $('.about__img-cover--1').offset().top - height / 1.5){
			$('.about__img-cover--1').addClass('about__img-cover--show-left');
		}
	}

	if($('.about__img-cover--2').length){
		if(wScroll > $('.about__img-cover--2').offset().top - height / 1.5){
			$('.about__img-cover--2').addClass('about__img-cover--show-right');
		}
	}

	if($('.slider').length){
		if(wScroll > $('.slider').offset().top - height / 1.5){
			$('.slider').addClass('slider--show');
		}
	}

	if($('.news-inner__img').length){
		if(wScroll > $('.news-inner__img').offset().top - height / 1.5){
			$('.news-inner__img').addClass('news-inner__img--show');
		}
	}

	if($('.team__banner-img').length){
		if(wScroll > $('.team__banner-img').offset().top - height / 2){
			$('.team__banner-img').addClass('team__banner-img--show');
		}
	}

    if($('.parties--effect').length){
        $('.parties--effect').each(function (i) {
            if(wScroll > $('.parties--effect').eq(i).offset().top / 2){
                $('.parties--effect').eq(i).addClass('fadein');
            }
        });
    }

	if($('.form__checkout').length){
		checkoutOffset = $('.form__checkout').offset().top;
		if(wScroll > checkoutOffset){
			// console.log(checkoutOffset);
			$('.form__checkout').addClass('form__checkout--fixed');
		}
		else{
			$('.form__checkout').removeClass('form__checkout--fixed');
		}
	}

	if($('.section--video').length){
		checkVideoScroll();
	}

	if($('.flow').length && width > 767){
		flowCharacters();
	}

	if(window.location.hash){
		var hash = window.location.hash;
        hash = hash.replace("#", "");

        var splitedModalData = hash.split('-');
        openModal(splitedModalData);
	}

	if($('.home-video').length){
        audio = $('.audio')[0];
        audio.play();
        if(width < 768){
            audio.volume = 0;
		}
	}
})();

var activeDropdown;

$('[data-form-dropdown]').on('click', function(){
	var parent = $(this).parent();
	activeDropdown = parent.find('.form__options');
	activeOption = $('.form__option--active', activeDropdown);
	// console.log(activeOption);
	$('.form__options').stop(true, true).slideUp(300);
	activeDropdown.stop(true, true).slideDown(300);
});

$('.nav__list-link').on('click', function(){
	var parent = $(this).parent();
	var sublist = parent.find('.nav__sublist');
	sublist.addClass('nav__sublist--show');
});


$('[data-open-mobile-lightbox]').on('click', function(){
	var parent = $(this).parent();
	activeDropdown = parent.find('.category-nav');
	activeOption = $('.category-nav__item--active', activeDropdown);
	activeDropdown.slideDown(300);
	$htmlbody.addClass('hidden');
});

$('[data-open-mobile-lightbox-schedule]').on('click', function(){
	var parent = $(this).parent();
	activeDropdown = parent.find('.schedule__btns-wrap');
	activeOption = $('.schedule__btn--active', activeDropdown);
	activeDropdown.slideDown(300);
	$htmlbody.addClass('hidden');
});


$('[data-close-lightbox]').on('click', function(){

	if($('.schedule__btn').length){
		$('.schedule__btn', activeDropdown).removeClass('schedule__btn--active');
		activeOption.addClass('schedule__btn--active');
		openDay();
	}


	if($('.category-nav__item').length){
		$('.category-nav__item', activeDropdown).removeClass('category-nav__item--active');
		activeOption.addClass('category-nav__item--active');
		var id = activeOption.data('category-nav-item');
		displayCategory(id);
		if($('.category-nav__item--schedule').length){
			openType();
		}
	}

	$('.category-nav').slideUp(300);
	$('.schedule__btns-wrap').slideUp(300);
	$htmlbody.removeClass('hidden');
});

$('[data-submit]').on('click', function(){
	var parent = $(this).parent();
	var parentParent = parent.parent();
	var activeElement = parent.find('.category-nav__item--active');
	var current = parentParent.find('.category-current-mobile');
	var value = activeElement.text();

	current.html(value);
	$('.category-nav').slideUp(300);
	$htmlbody.removeClass('hidden');
});

$('[data-submit-form]').on('click', function(){
	activeInput.val(forDropdownOption);
	$('.form__options').slideUp(300);
	$htmlbody.removeClass('hidden');
});

$('[data-close-lightbox-form]').on('click', function(){
	forDropdownOption = "";
	activeInput = "";

	$('[data-option]', activeDropdown).removeClass('form__option--active');
	activeOption.addClass('form__option--active');

	$('.form__options').slideUp(300);
	$htmlbody.removeClass('hidden');
});

$('[data-submit-shedule]').on('click', function(){
	var parent = $(this).parent();
	var parentParent = parent.parent();
	var activeElement = parent.find('.schedule__btn--active > .schedule__btn-mobile');
	var current = parentParent.find('.category-current-mobile');
	var value = activeElement.text();

	current.html(value);
	$('.schedule__btns-wrap').slideUp(300);
	$htmlbody.removeClass('hidden');
});

$('[data-close-checkout]').on('click', function(){
	$('.form__checkout').slideUp(300);
});

$('[data-open-checkout]').on('click', function(){
	$('.form__checkout').slideDown(300);
});

$(window).on('scroll', function(){
	wScroll = $(this).scrollTop();
    
    if(wScroll > 0){
		$('.header').addClass('header--sticky');
	}
	else{
        $('.header').removeClass('header--sticky');
	}

	if($('.section--header').length){
		if(wScroll > homeHeaderHeight){
            if($('.video-sound').hasClass('video-sound--active')){
                audio.volume = 0;
                $('.video-sound').toggleClass('video-sound--active');
            }
		}
	}
    
	if($('.form__checkout').length){
		if(wScroll > checkoutOffset){
			// console.log(checkoutOffset);
			$('.form__checkout').addClass('form__checkout--fixed');
		}
		else{
			$('.form__checkout').removeClass('form__checkout--fixed');
		}
	}
    
	if($('.highlights__row--first').length){
		if(wScroll > $('.highlights__row--first').offset().top - height / 1.5){
			$('.highlights__row--first > .person-block--highlights').each(function(i){
				setTimeout(function(){
					$('.highlights__row--first > .person-block--highlights').eq(i).addClass('person-block--show');
				}, i * 200);
			});
		}
	}

	if($('.highlights__row--second').length){
		if(wScroll > $('.highlights__row--second').offset().top - height / 1.5){
			$('.highlights__row--second > .person-block--highlights').each(function(i){
				setTimeout(function(){
					$('.highlights__row--second > .person-block--highlights').eq(i).addClass('person-block--show');
				}, i * 200);
			});
		}
	}

	if($('.about__img-cover--1').length){
		if(wScroll > $('.about__img-cover--1').offset().top - height / 1.5){
			$('.about__img-cover--1').addClass('about__img-cover--show-left');
		}
	}

	if($('.about__img-cover--2').length){
		if(wScroll > $('.about__img-cover--2').offset().top - height / 1.5){
			$('.about__img-cover--2').addClass('about__img-cover--show-right');
		}
	}

	if($('.slider').length){
		if(wScroll > $('.slider').offset().top - height / 1.5){
			$('.slider').addClass('slider--show');
		}
	}

	if($('.news-inner__img').length){
		if(wScroll > $('.news-inner__img').offset().top - height / 1.5){
			$('.news-inner__img').addClass('news-inner__img--show');
		}
	}

	if($('.team__banner-img').length){
		if(wScroll > $('.team__banner-img').offset().top - height / 2){
			$('.team__banner-img').addClass('team__banner-img--show');
		}
	}

	if($('.parties--effect').length){
		$('.parties--effect').each(function (i) {
			if(wScroll > $('.parties--effect').eq(i).offset().top / 1.2){
                $('.parties--effect').eq(i).addClass('fadein');
			}
        });
	}
});

$('.nav__back').on('click', function(){
	$('.nav__list').removeClass('nav__list--mobile');
	$('.nav__sublist').removeClass('nav__sublist--show');
});

$(document).on('click', function(e){
	var container = $(".form__row--options");

    if (!container.is(e.target) && container.has(e.target).length === 0) 
    {
        $('.form__options').slideUp(300);
    }

    var container2 = $(".form__question");

    if (!container2.is(e.target) && container2.has(e.target).length === 0) 
    {
        $('.form__question').removeClass('form__question--active');
    }
});

$('[data-single-size]').on('click', function(){
	var value = $(this).text();
	var parent = $(this).parent().parent();
	var current = parent.find('.form__size-current');

	current.text(value);
	$('[data-size-list]').slideUp(300);
});

$('[data-plus]').on('click', function(){
	var parent = $(this).parent();
	var value = parent.find('[data-value]');
	var number = parseInt(value.text());
	value.html(number+1);
});

$('[data-minus]').on('click', function(){
	var parent = $(this).parent();
	var value = parent.find('[data-value]');
	var number = parseInt(value.text());
	if(number > 0){
		value.html(number-1);
	}
});

$('[data-size]').on('click', function(){
	var parent = $(this).parent();
	var list = parent.find('[data-size-list]');
	list.slideDown(300);
});

$('[data-option]').on('click', function(){
	var parent = $(this).parent().parent();
	activeInput = parent.find('[data-form-dropdown]');
	var dropdown = parent.find('.form__options');

	$('.form__option', dropdown).removeClass('form__option--active');
	$(this).addClass('form__option--active');
	forDropdownOption = $(this).text();

	if(width > 767){
		dropdown.slideUp(300);
		activeInput.val(forDropdownOption);
	}
	
});

$menu.on('click', function(){
	$page.addClass('page--hide');
	if($('.header').hasClass('header--sticky')){
        $('.header').addClass('header--hide');
	}
	else{
        $('.header').addClass('header--hide-not-sticky');
	}
    $('.status').addClass('status--slideaway');
	$('.nav').addClass('nav--active');
	$htmlbody.addClass('hidden');
	pageClickTrigger = 0;
});


$page.on('click', function(){
	pageClickTrigger++;
	if($page.hasClass('page--hide') && pageClickTrigger == 2){
		$page.removeClass('page--hide');

        if($('.header').hasClass('header--sticky')){
            $('.header').removeClass('header--hide');
        }
        else{
            $('.header').removeClass('header--hide-not-sticky');
        }

        $('.status').removeClass('status--slideaway');
		$('.nav').removeClass('nav--active');
		setTimeout(function(){
			$htmlbody.removeClass('hidden');
		}, 400);
		pageClickTrigger = 0;
	}

	if($modal.hasClass('modal--active') && pageClickTrigger == 2){
		$htmlbody.removeClass('hidden');
		$modal.removeClass('modal--active');
	}
});

$closeMenu.on('click', function(){
	pageClickTrigger = 0;
	$page.removeClass('page--hide');
    if($('.header').hasClass('header--sticky')){
        $('.header').removeClass('header--hide');
    }
    else{
        $('.header').removeClass('header--hide-not-sticky');
    }
    $('.status').removeClass('status--slideaway');
	setTimeout(function(){
		$htmlbody.removeClass('hidden');
		$('.nav').removeClass('nav--active');
	}, 400);
});

$scrollDown.on('click', function(){
	$htmlbody.animate({ 
		scrollTop: $('.section--video').offset().top
	}, 500);
});

var openModalCounter = 0;
$openModal.on('click', function(){
    openModalCounter++;

    checkScrollbar();

	var modalData = $(this).data('open-modal');
	var splitedModalData = modalData.split('-');

	if(openModalCounter == 1){
        openModal(splitedModalData);
    }

});

function openModal(splitedModalData) {
    var prefix = splitedModalData[0];
    var id = splitedModalData[1];
    var endpoint = '';

    $('.modal__content').remove();

    if(prefix == 'teacher'){

        $.request('onTeacherLoad', {
            data: { id: id },
            success: function( data ) {
                $('.modal').append( data.result );
                $('.modal').addClass('modal--active');
                initScrollBar();
            }
        })
    
    }
    else if(prefix == 'artists'){
        
        $.request('onArtistsLoad', {
            data: { id: id },
            success: function( data ) {
                $('.modal').append( data.result );
                $('.modal').addClass('modal--active');
                initScrollBar();
            }
        })
        
    }
    else if(prefix == 'bands'){
        
        $.request('onTripLoad', {
            data: { id: id },
            success: function( data ) {
                $('.modal').append( data.result );
                $('.modal').addClass('modal--active');
                initScrollBar();
            }
        })
        
    }
    else if(prefix == 'trip'){
        
        $.request('onTripLoad', {
            data: { id: id },
            success: function( data ) {
                $('.modal').append( data.result );
                $('.modal').addClass('modal--active');
                initScrollBar();
                video = $('.modal--active').find('video')[0];
            }
        })
        
    }
    else if(prefix == 'venues'){
        
        $.request('onVenuesLoad', {
            data: { id: id },
            success: function( data ) {
                $('.modal').append( data.result );
                $('.modal').addClass('modal--active');
                initScrollBar();
            }
        })
    }
    
    $htmlbody.addClass('hidden');
    pageClickTrigger = 0;
    
}

$(document).on('click', '[data-close-modal]', function(){
    openModalCounter = 0;
    var checkifvideo = $('.modal--active').find('video');

	if(checkifvideo.length && !video.paused){
		video.pause();
		$('.video__play-btn-wrap').removeClass('video__play-btn-wrap--hide');
	}

	$('.modal').removeClass('modal--active');
	$htmlbody.removeClass('hidden');
    $('.page').css('padding-right', '0');

    history.pushState("", document.title, window.location.pathname);
});

$(window).on('scroll', function(){
	wScroll = $(this).scrollTop();
});

$categoryNavItem.on('click', function(){
	var id = $(this).data('category-nav-item');
	$categoryNavItem.removeClass('category-nav__item--active');
	$(this).addClass('category-nav__item--active');
	displayCategory(id);
});

function displayCategory(id){
	$('[data-category-block]').removeClass('is-active');
	$('[data-category-block]').removeClass('is-active--djs-active');

	if(id == 'all'){
		$('[data-category-block]').addClass('is-active');
		if($('.venues__single').length){
            $('.venues__single.is-active').removeClass('is-third');
            $('.venues__single').addClass('is-default');
		}

	}
	else{
		$('[data-category-block='+id+']').addClass('is-active');
		if($('.venues__single').length){
            $('.venues__single').removeClass('is-default');
            checkifThird();
		}
        
        // if($('[data-letter]').length){
            // $('[data-letter]').removeClass('parties__letter-wrap--active');
            // $('[data-letter='+id+']').addClass('parties__letter-wrap--active');
        // }

	}

	if(id == 'djs'){
		$('[data-category-block='+id+']').addClass('is-active--djs-active');
	}
}

function checkifThird() {
    $('.venues__single').removeClass('is-third');
    var n = $('.venues__single.is-active').length;
    for(i = 0; i <= n; i++){
        if (i > 0 && i % 3 === 0){
            $('.venues__single.is-active').eq(i-1).addClass('is-third');
		}
	}
}

$openFaq.on('click', function(){
	var parent = $(this).parent();
	var content = parent.find('.faq__content-block');
	var title = parent.find('.faq__title');
	var btn = parent.find('.faq__open-block');

	btn.toggleClass('faq__open-block--active');
	title.toggleClass('faq__title--active');
	content.stop(true, true).slideToggle(300);
});

function openDay(){

	var activeDaysLength = $('.schedule__btn--active').length;
	var activeTypesLength = $('.category-nav__item--active').length;
	var eventsLength = $('.event').length;

	if(activeDaysLength == 0){
		activeDaysLength = $('.schedule__btn').length;
	}

	if($('.category-nav__item--active').data('schedule-nav-item') == 'all'){
		activeTypesLength = $('.category-nav__item').length;
	}

	$('.event').removeClass('event--show');
	$('.event').addClass('event--hide');

	// console.log('d: '+activeDaysLength);
	// console.log('tp: '+activeTypesLength);
	// console.log('ev: '+eventsLength);

	for(i = 0; i < activeDaysLength; i++){
		var day;
		if(activeDaysLength == $('.schedule__btn').length){
			day = $('.schedule__btn').eq(i).data('day');
		}
		else{
			day = $('.schedule__btn--active').eq(i).data('day');
		}
		if($('.category-nav').length){
			for(j = 0; j < activeTypesLength; j++){
				var type;
				if(activeTypesLength == $('.category-nav__item').length){
					type = $('.category-nav__item').eq(j).data('schedule-nav-item');
				}
				else{
					type = $('.category-nav__item--active').eq(j).data('schedule-nav-item');
				}
				for(k = 0; k < eventsLength; k++){
					if($('.event').eq(k).data('event-day') == day && $('.event').eq(k).data('event-type') == type){
						$('.event').eq(k).removeClass('event--hide');
						$('.event').eq(k).addClass('event--show');
					}
				}
			}
		}
		else{
			for(k = 0; k < eventsLength; k++){
				if($('.event').eq(k).data('event-day') == day){
					$('.event').eq(k).removeClass('event--hide');
					$('.event').eq(k).addClass('event--show');
				}
			}
		}
	}

	hideHourRow();
}

$openDay.on('click', function(){
	if(width > 767){
		$(this).toggleClass('schedule__btn--active');
	}
	else{
		$('.schedule__btn').removeClass('schedule__btn--active');
		$(this).addClass('schedule__btn--active');
	}

	openDay();
});	

function openType(){
	var activeDaysLength = $('.schedule__btn--active').length;
	var activeTypesLength = $('.category-nav__item--active').length;
	var eventsLength = $('.event').length;

	if($(this).data('schedule-nav-item') != 'all'){
		$('[data-schedule-nav-item="all"]').removeClass('category-nav__item--active');
	}
	else{
		$('[data-schedule-nav-item]').removeClass('category-nav__item--active');
		activeTypesLength = $('.category-nav__item').length;
	}

	

	if(activeDaysLength == 0){
		activeDaysLength = $('.schedule__btn').length;
	}

	if($('.category-nav__item--active').length == 0){
		$('[data-schedule-nav-item="all"]').addClass('category-nav__item--active');
		activeTypesLength = $('.category-nav__item').length;
	}

	// console.log('d: '+activeDaysLength);
	// console.log('tp: '+activeTypesLength);
	// console.log('ev: '+eventsLength);

	$('.event').removeClass('event--show');
	$('.event').addClass('event--hide');

	for(i = 0; i < activeDaysLength; i++){
		var day;
		if(activeDaysLength == $('.schedule__btn').length){
			day = $('.schedule__btn').eq(i).data('day');
		}
		else{
			day = $('.schedule__btn--active').eq(i).data('day');
		}
		for(j = 0; j < activeTypesLength; j++){
			var type;
			if(activeTypesLength == $('.category-nav__item').length){
				type = $('.category-nav__item').eq(j).data('schedule-nav-item');
			}
			else{
				type = $('.category-nav__item--active').eq(j).data('schedule-nav-item');
			}
			for(k = 0; k < eventsLength; k++){
				if($('.event').eq(k).data('event-day') == day && $('.event').eq(k).data('event-type') == type){
					// console.log($('.event').eq(k));
					$('.event').eq(k).removeClass('event--hide');
					$('.event').eq(k).addClass('event--show');
				}
			}
		}
	}

	hideHourRow();
}

$('[data-schedule-nav-item]').on('click', function(){
	if(width > 767){
		$(this).toggleClass('category-nav__item--active');
	}
	else{
		$('.category-nav__item').removeClass('category-nav__item--active');
		$(this).addClass('category-nav__item--active');
	}
	openType();
});

function hideHourRow(){
	var n = $('.schedule__events-hour').length;
	for(i = 0; i < n; i++){
		var parent = $('.schedule__events-hour').eq(i);
		if($('.event', parent).length == $('.event--hide', parent).length){
			parent.addClass('schedule__events-hour--hide');
		}
		else{
			parent.removeClass('schedule__events-hour--hide');
		}
	}
}


function paralaxLetterH(){
	$(window).on('scroll', function(){
		$('.letters--h').css('transform', 'translateY('+wScroll / 40 +'%)');
	});
}

function paralaxLetterHSlow() {
    $(window).on('scroll', function(){
        $('.letters--h').css('transform', 'translateY('+wScroll / 60 +'%)');
    });
}


function paralaxLetterA(){
	$(window).on('scroll', function(){
		$('.letters--a').css('transform', 'translateY('+wScroll / 30 +'%)');
	});
}

function paralaxLetterASlow(){
    $(window).on('scroll', function(){
        $('.letters--a').css('transform', 'translateY('+wScroll / 60 +'%)');
    });
}

function paralaxLetterR(){
	$(window).on('scroll', function(){
		$('.letters--r').css('transform', 'translateY('+wScroll / 45 +'%)');
	});
}

function paralaxLetterRSlow(){
    $(window).on('scroll', function(){
        $('.letters--r').css('transform', 'translateY('+wScroll / 90 +'%)');
    });
}

function paralaxLetterL(){
	$(window).on('scroll', function(){
		$('.letters--l').css('transform', 'translateY('+wScroll / 50 +'%)');
	});
}

function paralaxLetterLSlow(){
    $(window).on('scroll', function(){
        $('.letters--l').css('transform', 'translateY('+wScroll / 100 +'%)');
    });
}

function paralaxLetterE(){
	$(window).on('scroll', function(){
		$('.letters--e').css('transform', 'translateY('+wScroll / 55 +'%)');
	});
}

function paralaxLetterESlow(){
    $(window).on('scroll', function(){
        $('.letters--e').css('transform', 'translateY('+wScroll / 110 +'%)');
    });
}

function paralaxLetterM(){
	$(window).on('scroll', function(){
		$('.letters--m').css('transform', 'translateY('+wScroll / 50 +'%)');
	});
}

function paralaxLetterMSlow(){
    $(window).on('scroll', function(){
        $('.letters--m').css('transform', 'translateY('+wScroll / 100 +'%)');
    });
}

function initSlider(){
	var slider = new Swiper('[data-slider]', {
        nextButton: '[data-arrow-next]',
        prevButton: '[data-arrow-prev]',
        slidesPerView: 1,
        loop: true,
        fade: { crossFade: true },
        effect: 'fade',
        speed: 1000,
    });
	slider.on('onSlideChangeStart', function () {
		$('[data-slider-mobile]').removeClass('slider__text-wrap-single--active');
		$('[data-slider-mobile='+slider.realIndex+']').addClass('slider__text-wrap-single--active')
    });
}

function callMap(){
    var map=document.createElement('script');
    map.type='text/javascript';
    map.src='https://maps.googleapis.com/maps/api/js?key=AIzaSyAbXOh4xza0eDKDBAB06pJF-mEAK6CYr6s&callback=initMap';
    document.body.appendChild(map);
}

$('.form__checkbox').iCheck({
  handle: 'checkbox',
  labelHover: false,
});

$('.form__radio').iCheck({
  handle: 'radio',
  labelHover: false,
});

$('.form__radio').on('click', function(){
	// console.log('a');
});

function initMap() {
    // Specify features and elements to define styles.
    var styleArray = [
    {
        "featureType": "administrative",
        "elementType": "labels.text.fill",
        "stylers": [
            {
                "color": "#444444"
            }
        ]
    },
    {
        "featureType": "landscape",
        "elementType": "all",
        "stylers": [
            {
                "color": "#f2f2f2"
            }
        ]
    },
    {
        "featureType": "poi",
        "elementType": "all",
        "stylers": [
            {
                "visibility": "off"
            }
        ]
    },
    {
        "featureType": "road",
        "elementType": "all",
        "stylers": [
            {
                "saturation": -100
            },
            {
                "lightness": 45
            }
        ]
    },
    {
        "featureType": "road.highway",
        "elementType": "all",
        "stylers": [
            {
                "visibility": "simplified"
            }
        ]
    },
    {
        "featureType": "road.arterial",
        "elementType": "labels.icon",
        "stylers": [
            {
                "visibility": "off"
            }
        ]
    },
    {
        "featureType": "transit",
        "elementType": "all",
        "stylers": [
            {
                "visibility": "off"
            }
        ]
    },
    {
        "featureType": "water",
        "elementType": "all",
        "stylers": [
            {
                "color": "#9d9d9e"
            },
            {
                "visibility": "on"
            }
        ]
    }];

    var iconBlack = {
	    url: baseHref+"themes/harlem/assets/images/pin-dark.png",
	    scaledSize: new google.maps.Size(27, 85),
	    origin: new google.maps.Point(0,0),
		anchor: new google.maps.Point(0,0)
   }

   var iconBright = {
	    url: baseHref+"themes/harlem/assets/images/pin-bright.png",
	    scaledSize: new google.maps.Size(27, 85),
	    origin: new google.maps.Point(0,0),
		anchor: new google.maps.Point(0,0)
   }

   var iconVero = {
   		url: baseHref+"themes/harlem/assets/images/pin-vero.png",
   		scaledSize: new google.maps.Size(27, 85),
	    origin: new google.maps.Point(0,0),
		anchor: new google.maps.Point(0,0)
   }

   var iconLindyTripStart = {
   		url: baseHref+"themes/harlem/assets/images/pin-lindy.png",
	    origin: new google.maps.Point(0,0),
		anchor: new google.maps.Point(30,20),
   }

    var iconLindyTripEnd = {
        url: baseHref+"themes/harlem/assets/images/pin-lindy.png",
        origin: new google.maps.Point(0,0),
        anchor: new google.maps.Point(0,10),
    }

	var latitude = 54.6871555;
	var longitude = 25.279651400000034;
	var zoom = 15;

	var map = new google.maps.Map(document.getElementById('map'), {
		center: {lat:  latitude, lng: longitude},
		scrollwheel: false,
		styles: styleArray,
		zoom: zoom,
	});

    var lindyTrip = [
        //start point X and Y
        ['54.687157', '25.280405'],
        //end point X and Y
        ['54.685215', '25.288423']
    ];

	var flightPlanCoordinates = [];

    for(i = 0; i < lindyTrip.length; i++){
		var arrow = new google.maps.LatLng(lindyTrip[i][0], lindyTrip[i][1]);
		flightPlanCoordinates.push(arrow);
	}

	var flightPath = new google.maps.Polyline({
		path: flightPlanCoordinates,
		strokeOpacity: 1.0,
		strokeWeight: 1,
		strokeColor: '#434343',
		icons: [{
	        icon: {path: google.maps.SymbolPath.FORWARD_OPEN_ARROW},
	        offset: '100%'
	    }]
	});

    flightPath.setMap(map);
    
    if( lessons && lessons.length > 0 )
    {
        for(i = 0; i < lessons.length; i++){
            marker = new google.maps.Marker({
                map: map,
                position: new google.maps.LatLng(lessons[i][0], lessons[i][1]),
                icon: iconBright
            });
        }
    }

    if( parties && parties.length > 0 )
    {
        for(i = 0; i < parties.length; i++){
            marker = new google.maps.Marker({
                map: map,
                position: new google.maps.LatLng(parties[i][0], parties[i][1]),
                icon: iconBlack
            });
        }
    }

    if( veroCafe && veroCafe.length > 0 )
    {
        for(i = 0; i < veroCafe.length; i++){
            marker = new google.maps.Marker({
                map: map,
                position: new google.maps.LatLng(veroCafe[i][0], veroCafe[i][1]),
                icon: iconVero
            });
        }
    }

    marker = new google.maps.Marker({
		map: map,
		position: new google.maps.LatLng(lindyTrip[0][0], lindyTrip[0][1]),
		icon: iconLindyTripStart
	});

    marker = new google.maps.Marker({
        map: map,
        position: new google.maps.LatLng(lindyTrip[1][0], lindyTrip[1][1]),
        icon: iconLindyTripEnd
    });
}

// $('.form__question').on('click', function(){
// 	$(this).addClass('form__question--active');
// });

$('[data-close-status]').on('click', function(){
	$('.status').addClass('status--hide');
});

$('#ooo').on('click', function(){
	$('#mmm').css('right', 0);
});

$('[data-for]').on('click', function(){
	var parent = $(this).parent();
	var checkbox, radio;

	radio = parent.find('.iradio > .iradio');
	checkbox = parent.find('.icheckbox > .icheckbox');

	if(radio.length != 0){
		radio.iCheck('toggle');
	}

	if(checkbox.length != 0){
		checkbox.iCheck('toggle');
	}
});

$('input[readonly]').on('focus', function() {
	$(this).trigger('blur');
});

var tag = document.createElement('script');
tag.src = "https://www.youtube.com/iframe_api";
var firstScriptTag = document.getElementsByTagName('script')[0];
firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

var introPlayer;
var duration;
var buffered = false;
var started = false;

function setFrameSize() {
    var $introvid = document.getElementById('introvid');
    var $cont = $introvid.parentElement;
    var contH = $cont.clientHeight;
    var contW = $cont.clientWidth;
    var contRatio = contW / contH;
    var ytRatio = 16 / 9;
    var ytH = contH + 'px';
    var ytW = contW + 'px';
    $introvid.classList.remove('is-wide');
    $introvid.classList.remove('is-high');
    if (contRatio > ytRatio) {
        ytH = contW / ytRatio + 'px';
        $introvid.classList.add('is-wide');
    } else {
        ytW = contH * ytRatio + 'px';
        $introvid.classList.add('is-high');
    }
    $introvid.style.height = ytH;
    $introvid.style.width = ytW;
}

function onYouTubeIframeAPIReady() {
	var videoUrl = $('.section--video > .video').data('youtube-url');
    introPlayer = new YT.Player('introvid', {
        videoId: videoUrl,
        playerVars: {
            'modestbranding': 1,
            // 'iv_load_policy': 3,
            'enablejsapi': 1,
            // 'disablekb': 1,
            'showinfo': 0,
            'controls': 0
        },
        events: {
            'onReady': onPlayerReady,
            'onStateChange': function(e) {
                var $introFrame = document.getElementById('introvid');
                // console.log(e);
                if (!buffered) {
                    if (e.data == 3) {
                        buffered = true;
                    }
                } else if (!started && e.data == 1 && buffered) {
                    started = true;
                    var $introFrame = document.getElementById('introvid');
                    duration = introPlayer.getDuration();
                    e.target.playVideo();
                    startPlayLoop();
                    $introFrame.classList.add('is-ready');
                    setTimeout(function(){
                    	$('.video__placeholder').addClass('video__placeholder--hide');
                    }, 3500);
                }
            }
        }
    });
}

var YTevent;

function onPlayerReady(event) {
	YTevent = event.target;
    var $introFrame = document.getElementById('introvid');
    setFrameSize();
    duration = introPlayer.getDuration();
    if (!buffered) {
        event.target.playVideo();
    }
    event.target.setVolume(0);
}

function startPlayLoop() {
    introPlayer.seekTo(0.3);
    setTimeout(function() {
    	if(!$('.video__play-btn-wrap').hasClass('video__play-btn-wrap--hide')){
			startPlayLoop();
    	}
    }, 5000);
}

function startFromBeginning(){
	introPlayer.seekTo(0.3);
	$('.video__play-btn-wrap').addClass('video__play-btn-wrap--hide');
	YTevent.setVolume(50);
	// console.log(YTevent);
	setTimeout(function(){
		if($('.video__play-btn-wrap').hasClass('video__play-btn-wrap--hide')){
			startFromBeginning();
		}
	}, (duration * 1000) - 1000);
}

$('.video__play-btn--youtube').on('click', function () {
    $('.video__play-btn-wrap').addClass('video__play-btn-wrap--hide');
    startFromBeginning();
    if(width < 768){
        $('.section--video').addClass('section--fixed');
        $('.close--video-lightbox').addClass('close--video-lightbox-show');
        $('.video__placeholder').addClass('video__placeholder--hide');
        YTevent.playVideo();
        setFrameSize();
    }
});

$(document).on('click', '.video__play-btn--modal', function () {
    $('.video__play-btn-wrap').addClass('video__play-btn-wrap--hide');
    video.play();
});

$('[data-close-video]').on('click', function(){
	$('.close--video-lightbox').removeClass('close--video-lightbox-show');
	$('.video__placeholder').removeClass('video__placeholder--hide');
	$('.video__play-btn-wrap').removeClass('video__play-btn-wrap--hide');
	$('.section--video').removeClass('section--fixed');
	YTevent.setVolume(0);
});

$(window).on('orientationchange', function() {
  if($('.section--video').length){
  	setFrameSize();
  }
});

$(window).on('resize', function() {
  if($('.section--video').length){
  	setFrameSize();
  }
});

function checkVideoScroll(){
	$(window).on('scroll', function(){
		wScroll = $(window).scrollTop();
		if(wScroll > $('.section--video').offset().top + $('.section--video').height() || wScroll < $('.section--video').offset().top - $('.section--video').height()){
			if($('.video__play-btn-wrap').hasClass('video__play-btn-wrap--hide')){
				$('.video__play-btn-wrap').removeClass('video__play-btn-wrap--hide')
				YTevent.setVolume(0);
				startPlayLoop();
			}
		}
	});
}

function flowCharacters(){
	var mouseX = 0, mouseY = 0;
	$(document).mousemove(function(e){
		// console.log(e.pageX);
		// console.log(e);
	   mouseX = e.pageX;
	   mouseY = e.pageY; 
	});

	var follower = $(".flow");
	var xp = 0, yp = 0;
	var loop = setInterval(function(){
		if(follower.hasClass('news__instrument')){
			xp += (mouseX / 400 - xp) / 12;
	    	yp += (mouseY / 400 - yp) / 12;
		}
		else{
			xp += (mouseX / 200 - xp) / 12;
	    	yp += (mouseY / 200 - yp) / 12;
		}
	    
	    follower.css('transform', 'translate('+ xp + '%, ' + yp + '%)');    
	}, 30);
}

function checkScrollbar() {
    var scrollbarW = window.innerWidth - document.body.clientWidth;
    if(document.body.clientWidth !== window.innerWidth){
        $('.page').css('padding-right', scrollbarW);
    }
    else{
        $('.page').css('padding-right', '0');
    }
}



$('.form__question').on('click', function (e) {
    var elem = $(this).find('.form__question-text');
    elem.slideDown(300);
    if($(e.target).is('[data-close-tooltip]')){
        //$('.form__question-text').removeClass('form__question-text--show');
        $('.form__question-text').slideUp(300);
        e.preventDefault();
        return;
    }
});

$('.video-sound').on('click', function () {
	$(this).toggleClass('video-sound--active');
	if($('.video-sound').hasClass('video-sound--active')){
		audio.volume = 1;
	}
	else{
        audio.volume = 0;
	}
});



function initScrollBar() {
    if(width > 767){
		ps = new PerfectScrollbar('#container', {
            wheelSpeed: 2,
            wheelPropagation: true,
        });
    }
}